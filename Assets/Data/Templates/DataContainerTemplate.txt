using System.Collections.Generic;
using Newtonsoft.Json.Linq;
using Newtonsoft.Json;
using UnityEngine;
using System.Linq;
using System;

public class Data#fileName#Container : IBaseDataContainer
{
    private Dictionary<int, Data#fileName#> dicById = new();
    private Dictionary<string, Data#fileName#> dicByNameId = new();
	private Data#fileName#[] datas = null;
    public string FileName => "#fileName#";
	
	#if UNITY_EDITOR
    public string LocalJsonPath => PathDefine.Json + $"/{FileName}.json";
	#endif
	
	public bool Serialized => dicById != null && dicByNameId != null && datas != null;
    public void SerializeJson(string json)
    {
        try
        {
            JArray jArray = JArray.Parse(json);
            foreach(var jObj in jArray)
            {
                Data#fileName# data = JsonConvert.DeserializeObject<Data#fileName#>(jObj.ToString());
                if (!dicById.ContainsKey(data.Id))
                {
                    dicById.Add(data.Id, data);
                }
                else
                {
                    Debug.LogError($"ID 중복 {data.GetType()} / {data.Id}");
                }

                if (!dicByNameId.ContainsKey(data.NameId))
                {
                    dicByNameId.Add(data.NameId, data);
                }
                else
                {
                    Debug.LogError($"NameID 중복 {data.GetType()} / {data.NameId}");
                }
            }
			datas = dicById.Values.ToArray();
        }
        catch (Exception e)
        {
            Debug.LogError("Json Parsing 실패 !!");
            Debug.LogError(e.StackTrace);
        }
    }
    public Data#fileName# GetById(int id)
    {
        if (dicById.ContainsKey(id))
            return dicById[id];

        return default;
    }
    public Data#fileName# GetByNameId(string nameId)
    {
        if (dicByNameId.ContainsKey(nameId))
            return dicByNameId[nameId];

        return default;
    }
	public Data#fileName# Find(Predicate<Data#fileName#> predicate)
    {
        return Array.Find(datas, predicate);
    }

    public Data#fileName#[] FindAll(Predicate<Data#fileName#> predicate)
    {
        return Array.FindAll(datas, predicate);
    }
}